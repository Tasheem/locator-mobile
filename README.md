# Getting Started
- Install node and npm if you do not have it on your system already.
  - You can check by running these commands in a zsh or bash shell:
```bash 
node --version
```
```bash 
npm --version
```

- You also need to have Android Emulator setup through Android Studio and/or iOS Simulator setup through Xcode.
- Clone this repo onto your local machine.

# Running The Project
- Go to the root directory of the project and run:
```bash
npm start
```
- This will run the mobile app connected to the Locator server hosted in the Cloud.
- If you want to run the app connected to the localhost backend, boot the app like this:
```bash
npm run dev
```

- The Expo CLI will come and prompt you with options to run the app on Android emulator, iOS Simulator, and more.
- You can enter the keys "a" or "i" to allow Expo to open up your Android Emulator or iOS Simulator.

# In The App
- The login screen will be presented to you.
  - Login if you already have an account.
  - Click the register button at the bottom to create an account.
    - Fill out all the fields on the register screen. At the time, there are only form validation checks on the password confirmation field and whether or not you've entered in meal preferences.
- After logged in, you can create a room and add friends to it.
  - Other users of the app can be searched in the participants screen, so you can add people to your room there.

# Recommendation Screen
- This shows all the food options in your area and ranks them based on the percentage of people in your room who's meal preferences are satisfied by the given food options.
  - The list only contains venues that are open at the time, based on their opening/closing hours.

# Publishing to Apple App Store

Generate the production build:
```bash
npm run prebuild
```
If you get an error when it tries to clean the directories, just manually remove them:
```bash
rm -rf ios
rm -rf android
```
Run this to test production build on iOS simulator:
```bash
npm run ios
```
Run production build in XCode:
- Go to Product at the top bar.
- In the dropdown, go to Scheme.
- Then select the **Edit Scheme** option
  - A window should pop up.
- Go to the **Run** tab on the left.
- Under the **info** tab in the main section, change **Build Configuration** from Debug to Release.
  - This will get the app to run with the .env.production file.

## Note
There maybe a prompt to install TypeScript, and sometimes it leads to an infinite loop, installing TypeScript over and over again when you select yes. If this happens, select no. The npm script will stop running and throw an error. After this, run the command again and it should succeed the second time.

## .env files
Somehow, .env.development is used when running in Debug mode in XCode and .env.production is used when running in Release mode in XCode. This is regardless of the NODE_ENV set when running expo prebuild. I am not sure how XCode knows which .env files to pull when running the app.

Many times, a terminal window will open for expo-development-client. This can open in either Debug or Release mode. The terminal will say that the .env.development file is loaded, even in Release mode, but requests are still made to prod URLs regardless.

## Info.plist
These privacy descriptions need to be added to the **Info.plist** in XCode. Translate this JSON to the key value pairs in the **Info.plist** file:

```JSON
{
  "Privacy - Location Always and When In Use Usage Description": "$(PRODUCT_NAME) uses your GPS coordinates to find food in your particular area.",

  "Privacy - Location Always Usage Description": "$(PRODUCT_NAME) uses your GPS coordinates to find food in your particular area.",

  "Privacy - Location When In Use Usage Description": "$(PRODUCT_NAME) uses your GPS coordinates to find food in your particular area.",

  "Privacy - Photo Library Usage Description": "$(PRODUCT_NAME) will tie your photos to your account so that people can see who you are."
}
```

## Building the ipa for the App Store
- Navigate to the ios folder generated by expo prebuild
  - Open the ios/Locator.xcworkspace file in XCode by opening it in finder and double clicking on it.
- Make sure you're signed in with a paid Apple Developer Account.
  - Can enroll through the "Apple Developer Program".
- Click on the project name "Locator" and under **Signing & Capabilities**
  - In the team dropdown, choose the team/individual associated with the project.
- Click on the **General** tab and edit fields under the Identity section
  - Set Display Name to Locator.
  - Increment Version one above the latest version in the App Store.
  - Increment Build one above the latest Build sent to the App Store.
  - Remove any supported destinations that aren't iPhone.
- Add icons for app from https://www.appicon.co
  - Go to Locator > Locator > Images > AppIcon in XCode and drag the images (should be around 11 or 12 images) to the XCode screen that comes up.
- Build the app
  - Go to **Product** at the toolbar above the XCode Window.
  - In Product, select the **Build** option from the dropdown.
- Archive the app to create the ipa
  - After it finishes building, go to the device options at the top of XCode, and select the option **Any iOS Device**
  - Go back to **Product** in the toolbar, and select the **Archive** option.
    - When it finishes, a window should pop up showing archives.
    - If it doesn't pop up, go to the **Window** option in the toolbar above XCode, then select the **Organizer** option.
- Distrubute app
  - In the pop up window, select your build you just ran/created, then click the **Distribute App** button on the right.
  - Check the **App Store Connect** option, then click **Next**.
  - Check the **Upload** option, then click **Next** again.
  - For the distribution options, keep the default values checked (Should be all of them). Hit **Next**.
  - Select the **Automatically manage signing** option and hit **Next**.
  - Click the **Upload** button
- TestFlight
  - The build should appear in App Store Connect, under the TestFlight tab, around 10 minutes after you upload it.
- App Store Connect
  - Select build in **App Store Connect** under the main section (where it says **Prepare for Submission**).
  - Save it, then click **Add for Review**
  - Submit to App Review.

# Publishing to the Google Play Store

Generate the production build if you haven't already:
```bash
npm run prebuild
```
If you get an error when it tries to clean the directories, just manually remove them:
```bash
rm -rf ios
rm -rf android
```
Run this to test production build on iOS simulator:
```bash
npm run android
```

## Generate the keystore
This step maybe able to be skipped if the same keystore is being used to sign the app for future releases.

- Generate the keystore:
  - Navigate to your java_home
  - You can find it using either of these commands:

```bash
/usr/libexec/java_home
```

```bash
where $JAVA_HOME
```
- Run the command to generate the keystore:
```bash
sudo keytool -genkey -v -keystore my-upload-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
```
- Copy the keystore that was generated to the android/app directory. For example:
```bash
cp my-upload-key.keystore ~/React-Native/locator-mobile/android/app
```

## Set up signing settings for the app
- Add this to the **android/grade.properties** file.
  - The password should be the one used to generate the keystore.

```properties
MYAPP_UPLOAD_STORE_FILE=my-upload-key.keystore
MYAPP_UPLOAD_KEY_ALIAS=my-key-alias
MYAPP_UPLOAD_STORE_PASSWORD=****
MYAPP_UPLOAD_KEY_PASSWORD=****
```

- Add this to the **android/app/build.gradle** file, in the android {} portion.
  - In singingConfigs:

```groovy
release {
    if (project.hasProperty('MYAPP_UPLOAD_STORE_FILE')) {
        storeFile file(MYAPP_UPLOAD_STORE_FILE)
        storePassword MYAPP_UPLOAD_STORE_PASSWORD
        keyAlias MYAPP_UPLOAD_KEY_ALIAS
        keyPassword MYAPP_UPLOAD_KEY_PASSWORD
    }
}
```
- In **buildTypes -> release**, replace the debug signing setting with release:
```groovy
signingConfig signingConfigs.release
```

## Generating Assets
- Generate different sizes of the logo via this website: https://www.appicon.co
- Open the android directory in Android Studio.
- Right click on the **app** directory.
  - Select **New -> Image Asset**
  - Asset Studio should pop up.
- Add logo/image by selecting the folder in the **Path** text field.
- Resize the image if necessary.
- Navigate to the **Background Layer** tab and change the color to **CDCDCD** to get a gray background.
- This will likely only affect the **Full Bleed Layers** image, depending on how you resized the image.

## Building the aab/apk for the Google Play Store
- Navigate to the android folder in your terminal
- Execute this command:
```bash
./gradlew bundleRelease
```
- The aab should have been placed in the **android/app/build/outputs/bundle/release** directory.